alloy:
  # TODO: separate config file
  configMap:
    # default config
    # content: |
    #   discovery.kubernetes "pods"           {role = "pod"}
    #   discovery.kubernetes "nodes"          {role = "node"}
    #   discovery.kubernetes "services"       {role = "service"}
    #   discovery.kubernetes "endpoints"      {role = "endpoints"}
    #   discovery.kubernetes "endpointslices" {role = "endpointslice"}
    #   discovery.kubernetes "ingresses"      {role = "ingress"}
    content: |
      logging {
        level = "info"
        format = "logfmt"
      }
      prometheus.remote_write "main" {
        endpoint {
          url = "http://mimir-gateway.mimir.svc/api/v1/push"
        }
      }
      prometheus.operator.servicemonitors "main" {
        forward_to = [prometheus.remote_write.main.receiver]
      }
      prometheus.operator.podmonitors "main" {
        forward_to = [prometheus.remote_write.main.receiver]
      }
      mimir.rules.kubernetes "main" {
        address = "http://mimir-gateway.mimir.svc"
      }
